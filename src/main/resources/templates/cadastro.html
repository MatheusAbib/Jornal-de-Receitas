<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro - Jornal de Receitas</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/css/cadastro.css">
</head>
<body>
  
    <a href="/" class="back-link">
      <i class="fas fa-arrow-left"></i> Voltar para a página inicial
    </a>

  <div class="container">
    <div class="logo">
      <h1>✦ Jornal de Receitas ✦</h1>
      <p>Crie sua conta e faça parte da nossa comunidade</p>
    </div>

    <div id="alertBox" class="alert"></div>

  <form id="cadastroForm" th:action="@{/cadastro}" method="post">
  <!-- Linha 1: Nome e Email -->
  <div class="form-row">
    <div class="form-group">
      <label for="nome">Nome Completo</label>
      <div class="input-icon">
        <i class="fas fa-user"></i>
        <input type="text" id="nome" name="nome" class="form-control" required>
      </div>
    </div>

    <div class="form-group">
      <label for="email">E-mail</label>
      <div class="input-icon">
        <i class="fas fa-envelope"></i>
        <input type="email" id="email" name="email" class="form-control" required>
      </div>
    </div>
  </div>

  <!-- Linha 2: CPF, Telefone e Gênero -->
  <div class="form-row">
    <div class="form-group">
      <label for="cpf">CPF</label>
      <input type="text" id="cpf" name="cpf" class="form-control" required maxlength="14" placeholder="000.000.000-00">
    </div>

    <div class="form-group">
      <label for="telefone">Telefone</label>
      <input type="text" id="telefone" name="telefone" class="form-control" required maxlength="15" placeholder="(00) 00000-0000">
    </div>

    <div class="form-group">
      <label for="genero">Gênero</label>
      <select id="genero" name="genero" class="form-control" required>
        <option value="">Selecione</option>
        <option value="Masculino">Masculino</option>
        <option value="Feminino">Feminino</option>
        <option value="Outro">Outro</option>
      </select>
    </div>
  </div>

  <!-- Linha 3: Senha e Confirmar Senha -->
  <div class="form-row">
    <div class="form-group">
      <label for="senha">Senha</label>
      <div class="input-icon">
        <i class="fas fa-lock"></i>
        <input type="password" id="senha" name="senha" class="form-control" required>
        <span class="password-toggle" onclick="togglePassword('senha')"></span>
      </div>
    </div>

    <div class="form-group">
      <label for="confirmarSenha">Confirmar Senha</label>
      <div class="input-icon">
        <i class="fas fa-lock"></i>
        <input type="password" id="confirmarSenha" name="confirmarSenha" class="form-control" required>
        <span class="password-toggle" onclick="togglePassword('confirmarSenha')"></span>
      </div>
    </div>
  </div>

  <button type="submit" class="btn">Criar Conta</button>
</form>



    <div class="login-link">
      Já tem uma conta? <a href="/">Faça login</a>
    </div>
  </div>

  <script>
      function togglePassword(inputId) {
    const input = document.getElementById(inputId);
    if (input.type === 'password') input.type = 'text';
    else input.type = 'password';
  }

  // Máscaras simples
  const cpfInput = document.getElementById('cpf');
  cpfInput.addEventListener('input', function() {
    let v = this.value.replace(/\D/g, '');
    if(v.length > 3) v=v.slice(0,3)+'.'+v.slice(3);
    if(v.length > 7) v=v.slice(0,7)+'.'+v.slice(7);
    if(v.length > 11) v=v.slice(0,11)+'-'+v.slice(11,13);
    this.value = v;
  });

  const telInput = document.getElementById('telefone');
  telInput.addEventListener('input', function() {
    let v = this.value.replace(/\D/g,'');
    if(v.length > 0) v='('+v;
    if(v.length > 3) v=v.slice(0,3)+') '+v.slice(3);
    if(v.length > 9) v=v.slice(0,9)+'-'+v.slice(9,13);
    this.value = v;
  });

  // Validação de senhas
  document.getElementById('cadastroForm').addEventListener('submit', function(e) {
    const senha = document.getElementById('senha').value;
    const confirmarSenha = document.getElementById('confirmarSenha').value;
    const alertBox = document.getElementById('alertBox');

    if (senha !== confirmarSenha) {
      alertBox.textContent = 'As senhas não coincidem!';
      alertBox.className = 'alert alert-error';
      alertBox.style.display = 'block';
      e.preventDefault();
      return;
    }
    if (senha.length < 6) {
      alertBox.textContent = 'A senha deve ter pelo menos 6 caracteres!';
      alertBox.className = 'alert alert-error';
      alertBox.style.display = 'block';
      e.preventDefault();
      return;
    }
  });

  // Mensagem do servidor com redirecionamento
  const urlParams = new URLSearchParams(window.location.search);
  const success = urlParams.get('success');
  const error = urlParams.get('error');
  const alertBox = document.getElementById('alertBox');

  if(success){
    alertBox.textContent = decodeURIComponent(success);
    alertBox.className = 'alert alert-success';
    alertBox.style.display = 'block';

    // Redireciona após 3 segundos
    setTimeout(() => {
      window.location.href = '/';
    }, 3000);
  }

  if(error){
    alertBox.textContent = decodeURIComponent(error);
    alertBox.className = 'alert alert-error';
    alertBox.style.display = 'block';
  }
  </script>

</body>
</html>
